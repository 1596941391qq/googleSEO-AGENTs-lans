# Google SEO Agent - Phase 2 å®æ–½è®¡åˆ’

> **Multi-Agent AI Content Creation System**
> åˆ›å»ºæ—¶é—´: 2026-01-01
> é¢„è®¡å·¥æœŸ: 6-8 å‘¨

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒç›®æ ‡](#æ ¸å¿ƒç›®æ ‡)
3. [æˆ‘ä»¬è¦åšä»€ä¹ˆ](#æˆ‘ä»¬è¦åšä»€ä¹ˆ)
4. [æˆ‘ä»¬éœ€è¦ä»€ä¹ˆ](#æˆ‘ä»¬éœ€è¦ä»€ä¹ˆ)
5. [åç«¯æ¶æ„è®¾è®¡](#åç«¯æ¶æ„è®¾è®¡)
6. [å…³é”® API ç«¯ç‚¹](#å…³é”®apiç«¯ç‚¹)
7. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
8. [å®æ–½é˜¶æ®µ](#å®æ–½é˜¶æ®µ)
9. [æŠ€æœ¯é£é™©ä¸æŒ‘æˆ˜](#æŠ€æœ¯é£é™©ä¸æŒ‘æˆ˜)
10. [æˆæœ¬é¢„ä¼°](#æˆæœ¬é¢„ä¼°)

---

## é¡¹ç›®æ¦‚è¿°

### å½“å‰çŠ¶æ€ï¼ˆPhase 1 - å·²å®Œæˆï¼‰

âœ… å…³é”®è¯ç”Ÿæˆä¸æŒ–æ˜
âœ… æ’åæ¦‚ç‡åˆ†æ
âœ… SEO å†…å®¹ç­–ç•¥ç”Ÿæˆ
âœ… æ‰¹é‡ç¿»è¯‘åˆ†æ
âœ… ç§¯åˆ†ç³»ç»Ÿé›†æˆ
âœ… è·¨é¡¹ç›®è®¤è¯

### Phase 2 ç›®æ ‡ï¼ˆå¾…å®æ–½ï¼‰

æ„å»ºå®Œæ•´çš„**å¤šä»£ç† AI å†…å®¹åˆ›ä½œç³»ç»Ÿ**ï¼Œå®ç°ä»å…³é”®è¯æŒ–æ˜åˆ°å†…å®¹å‘å¸ƒå’Œè¿½è¸ªçš„å…¨è‡ªåŠ¨åŒ–æµç¨‹ã€‚

**æ ¸å¿ƒåˆ›æ–°ç‚¹**ï¼š

- 4 ä¸ªä¸“ä¸š AI ä»£ç†ååŒå·¥ä½œ
- 8 æ­¥å®Œæ•´å†…å®¹ä¼˜åŒ–æµç¨‹
- ä¸€é”®å‘å¸ƒåˆ°å¤šä¸ªå¹³å°
- è‡ªåŠ¨æ’åè¿½è¸ª

---

## æ ¸å¿ƒç›®æ ‡

### ä¸»è¦åŠŸèƒ½

1. **å¤šä»£ç† AI ç³»ç»Ÿ** - 4 ä¸ªä¸“ä¸šä»£ç†ï¼ˆSEO ç ”ç©¶å‘˜ã€å†…å®¹å†™æ‰‹ã€è´¨é‡å®¡æŸ¥ã€å›¾åƒåˆ›æ„ï¼‰
2. **å®Œæ•´å†…å®¹ç®¡é“** - ä»ç ”ç©¶åˆ°å‘å¸ƒçš„ 8 æ­¥è‡ªåŠ¨åŒ–æµç¨‹
3. **å›¾åƒè‡ªåŠ¨ç”Ÿæˆ** - Nano Banana 2 é›†æˆï¼ˆ4K é«˜è´¨é‡ï¼Œ5-10 ç§’/å›¾ï¼‰
4. **å¤šå¹³å°å‘å¸ƒ** - WordPressã€Mediumã€Ghost ç­‰ä¸€é”®å‘å¸ƒ
5. **æ™ºèƒ½è¿½è¸ªç³»ç»Ÿ** - å…³é”®è¯æ’åå’Œæµé‡ç›‘æ§

### æŠ€æœ¯æŒ‡æ ‡

- å•ç¯‡æ–‡ç« ç”Ÿæˆæ—¶é—´: < 3 åˆ†é’Ÿï¼ˆå«å›¾åƒï¼‰
- å†…å®¹è´¨é‡è¯„åˆ†: > 80 åˆ†
- AI æ£€æµ‹é€šè¿‡ç‡: > 90%
- SEO ä¼˜åŒ–è¦†ç›–ç‡: 100%

---

## æˆ‘ä»¬è¦åšä»€ä¹ˆ

### ğŸ¤– Part 1: å¤šä»£ç† AI ç³»ç»Ÿï¼ˆ4 ä¸ªä»£ç†ï¼‰

#### Agent 1: SEO ç ”ç©¶å®˜ (SEO Researcher)

**æ–‡ä»¶**: `api/agents/seo-researcher.ts`

**èŒè´£**:

- æœç´¢å¼•æ“åå¥½åˆ†æ
  - Google ranking factors
  - ChatGPT citation patterns
  - Claude reference behavior
  - Perplexity answer format
- ç«äº‰å¯¹æ‰‹åˆ†æ
  - Top 10 SERP æŠ“å–
  - å†…å®¹ç»“æ„æå– (H1-H3 hierarchy)
  - å†…å®¹æ¡†æ¶è¯†åˆ«
  - å†…å®¹ç¼ºå£å‘ç°
- å…³é”®è¯ç ”ç©¶
  - ä¸»å…³é”®è¯ä¼˜åŒ–å»ºè®®
  - LSI å…³é”®è¯æå–
  - å…³é”®è¯å¸ƒå±€è§„åˆ’
- GEO/AIO ä¼˜åŒ–å»ºè®®

**è¾“å…¥**:

```typescript
{
  keyword: string;
  targetLanguage: string;
  targetEngines: ['google', 'chatgpt', 'claude', 'perplexity'];
  location?: string; // For GEO optimization
}
```

**è¾“å‡º**:

```typescript
{
  searchPreferences: Record<string, OptimizationStrategy>;
  competitorAnalysis: {
    top10: CompetitorData[];
    structurePatterns: StructurePattern[];
    contentGaps: string[];
  };
  keywords: {
    primary: string;
    lsi: string[];
    density: number; // 1-2%
    placement: KeywordPlacement[];
  };
  geoRecommendations: GeoOptimization[];
  aioRecommendations: AIOOptimization[];
}
```

---

#### Agent 2: å†…å®¹å†™æ‰‹ (Content Writer)

**æ–‡ä»¶**: `api/agents/content-writer.ts`

**èŒè´£**:

- æ ¹æ® SEO ç ”ç©¶ç”Ÿæˆåˆç¨¿
- éµå¾ªç«äº‰å¯¹æ‰‹ç»“æ„
- å…³é”®è¯æ³¨å…¥ï¼ˆæŒ‰ä¼˜åŒ–ä½ç½®ï¼‰
- GEO ä¼˜åŒ–åº”ç”¨
- AIO ä¼˜åŒ–åº”ç”¨

**è¾“å…¥**:

```typescript
{
  seoResearch: Agent1Output; // æ¥è‡ªAgent 1
  targetLanguage: string;
  tone: "professional" | "casual" | "academic";
  wordCount: number;
}
```

**è¾“å‡º**:

```typescript
{
  title: string;
  metaDescription: string;
  content: string; // Markdown format
  structure: ContentStructure;
  appliedOptimizations: {
    keywords: KeywordPlacement[];
    geo: GeoOptimization[];
    aio: AIOOptimization[];
  };
}
```

---

#### Agent 3: è´¨é‡æŠŠå…³å®˜ (Quality Reviewer)

**æ–‡ä»¶**: `api/agents/quality-reviewer.ts`

**èŒè´£**:

- å…³é”®è¯å¯†åº¦éªŒè¯ (ç›®æ ‡: 1-2%)
- AI æ¦‚ç‡æ£€æµ‹
- GEO/AIO åˆè§„æ€§æ£€æŸ¥
- å¯è¯»æ€§è¯„åˆ† (Flesch Reading Ease)
- æ•´ä½“è´¨é‡è¯„åˆ† (0-100)
- æ”¹è¿›å»ºè®®ç”Ÿæˆ

**è¾“å…¥**:

```typescript
{
  content: Agent2Output;
  seoResearch: Agent1Output;
  qualityThresholds: {
    minScore: number; // Default: 80
    maxAIDetection: number; // Default: 30%
  }
}
```

**è¾“å‡º**:

```typescript
{
  keywordDensity: {
    score: number; // 0-100
    details: DensityCheck[];
  };
  aiDetection: {
    probability: number; // 0-100%
    details: AIDetectionResult[];
  };
  geoCompliance: ComplianceCheck;
  aioCompliance: ComplianceCheck;
  readability: {
    fleschScore: number;
    gradeLevel: string;
  };
  overallScore: number; // 0-100
  passed: boolean;
  suggestions: ImprovementSuggestion[];
}
```

---

#### Agent 4: å›¾æ–‡åˆ›æ„å®˜ (Image Creative Director)

**æ–‡ä»¶**: `api/agents/image-creative.ts`

**èŒè´£**:

- ä»å†…å®¹æå– 4-6 ä¸ªè§†è§‰ä¸»é¢˜
- ä¸ºæ¯ä¸ªä¸»é¢˜ç”Ÿæˆ Nano Banana 2 prompt
- è°ƒç”¨å›¾åƒç”Ÿæˆ APIï¼ˆå¹¶è¡Œè¯·æ±‚ï¼‰
- ä¸‹è½½å¹¶æ·»åŠ å…ƒæ•°æ®
- è§„åˆ’å›¾åƒåœ¨æ–‡ç« ä¸­çš„ä½ç½®

**è¾“å…¥**:

```typescript
{
  content: Agent2Output;
  imageCount: number; // Default: 4-6
  style: "realistic" | "illustration" | "abstract";
}
```

**è¾“å‡º**:

```typescript
{
  themes: ExtractedTheme[];
  images: {
    id: string;
    prompt: string;
    url: string;
    altText: string;
    position: number; // åœ¨æ–‡ç« ä¸­çš„ä½ç½®
    metadata: {
      width: number;
      height: number;
      format: string;
      exif: Record<string, any>;
    };
  }[];
  totalCost: number; // USD
}
```

---

### ğŸ”„ Part 2: å†…å®¹åˆ›ä½œç®¡é“ï¼ˆ8 æ­¥æµç¨‹ï¼‰

#### Step 1: æœç´¢å¼•æ“åå¥½åˆ†æ

**æ–‡ä»¶**: `api/pipeline/search-preferences.ts`

åˆ†æä¸åŒæœç´¢å¼•æ“çš„æ’åå› ç´ å·®å¼‚ã€‚

**API**: `POST /api/pipeline/search-preferences`

#### Step 2: ç«äº‰å¯¹æ‰‹åˆ†æ

**æ–‡ä»¶**: `api/pipeline/competitor-analysis.ts`

æ·±åº¦ SERP åˆ†æï¼Œæå– Top 10 å†…å®¹ç»“æ„ã€‚

**API**: `POST /api/pipeline/competitor-analysis`

#### Step 3: å…³é”®è¯ä¼˜åŒ–

**æ–‡ä»¶**: `api/pipeline/keyword-optimization.ts`

å…³é”®è¯å¯†åº¦è®¡ç®—ã€LSI å…³é”®è¯è¯†åˆ«ã€ä½ç½®è§„åˆ’ã€‚

**API**: `POST /api/pipeline/keyword-optimization`

#### Step 4: GEO ä¼˜åŒ–

**æ–‡ä»¶**: `api/pipeline/geo-optimization.ts`

åœ°ç†ä½ç½®å†…å®¹ä¼˜åŒ–ï¼ˆæœ¬åœ°æ¡ˆä¾‹ã€åœ°åŒºæ•°æ®ã€æœ¬åœ°åŒ–æªè¾ï¼‰ã€‚

**API**: `POST /api/pipeline/geo-optimization`

#### Step 5: AIO ä¼˜åŒ–

**æ–‡ä»¶**: `api/pipeline/aio-optimization.ts`

AI å¼•æ“ä¼˜åŒ–ï¼ˆQ&A æ ¼å¼ã€ç»“æ„åŒ–æ•°æ®ã€å¼•ç”¨ä¼˜åŒ–ï¼‰ã€‚

**API**: `POST /api/pipeline/aio-optimization`

#### Step 6: å†…å®¹ç”Ÿæˆ

**æ–‡ä»¶**: `api/pipeline/content-generation.ts`

ç»¼åˆæ‰€æœ‰ä¼˜åŒ–å»ºè®®ç”Ÿæˆæœ€ç»ˆæ–‡ç« ã€‚

**API**: `POST /api/pipeline/content-generation`

#### Step 7: è´¨é‡æ£€æŸ¥

**æ–‡ä»¶**: `api/pipeline/quality-check.ts`

å…¨é¢è´¨é‡æ£€æŸ¥å’Œè¯„åˆ†ã€‚

**API**: `POST /api/pipeline/quality-check`

#### Step 8: å›¾åƒç”Ÿæˆ

**æ–‡ä»¶**: `api/pipeline/image-generation.ts`

Nano Banana 2 å›¾åƒç”Ÿæˆå’Œé›†æˆã€‚

**API**: `POST /api/pipeline/image-generation`

---

### ğŸ“¤ Part 3: å‘å¸ƒç³»ç»Ÿ

#### å¹³å°é…ç½®

**æ–‡ä»¶**: `api/publish/configure.ts`

**æ”¯æŒå¹³å°**:

- WordPress (REST API)
- Medium (Official API)
- Ghost (Admin API)
- Webflow (API)
- Custom Webhooks

**API**: `POST /api/publish/configure`

```typescript
{
  platform: 'wordpress' | 'medium' | 'ghost';
  credentials: {
    url?: string; // For WordPress
    username?: string;
    password?: string; // Application password
    apiToken?: string; // For Medium/Ghost
  };
  contentConfig: {
    categories?: string[];
    tags?: string[];
    featuredImage?: boolean;
    status?: 'draft' | 'publish';
  };
}
```

#### ä¸€é”®å‘å¸ƒ

**æ–‡ä»¶**: `api/publish/execute.ts`

**API**: `POST /api/publish/execute`

```typescript
{
  contentDraftId: string;
  platformConfigId: string;
  scheduledAt?: Date; // Optional scheduling
}
```

---

### ğŸ“Š Part 4: è¿½è¸ªç³»ç»Ÿ

#### æ’åè¿½è¸ª

**æ–‡ä»¶**: `api/track/rankings.ts`

**è¿½è¸ªæŒ‡æ ‡**:

- Google æ’åä½ç½®
- ChatGPT å¼•ç”¨æ¬¡æ•°
- Claude å¼•ç”¨æ¬¡æ•°
- Perplexity å¯è§åº¦
- æœ‰æœºæµé‡ä¼°ç®—

**API**: `POST /api/track/rankings`

```typescript
{
  keywordIds: string[];
  searchEngines: string[];
  publicationId: string;
}
```

---

## æˆ‘ä»¬éœ€è¦ä»€ä¹ˆ

### ğŸ”§ æŠ€æœ¯ä¾èµ–

#### 1. AI & APIs

- âœ… **Gemini API** (å·²æœ‰) - ä¸»è¦ AI å¼•æ“

  - ç”¨é€”: æ‰€æœ‰ 4 ä¸ªä»£ç†çš„æ ¸å¿ƒ AI èƒ½åŠ›
  - æ¨¡å‹: gemini-2.5-flash
  - ä»£ç†: https://api.302.ai

- ğŸ†• **Nano Banana 2 API** (éœ€è¦)

  - ç”¨é€”: é«˜è´¨é‡å›¾åƒç”Ÿæˆ
  - æˆæœ¬: $0.05-0.08/image
  - è§„æ ¼: 4K åˆ†è¾¨ç‡ï¼Œ5-10 ç§’ç”Ÿæˆ
  - æ³¨å†Œ: https://nanobanana.com

- ğŸ†• **SERP APIs** (å¯é€‰ï¼Œå»ºè®®é…ç½®)

  - Serper API (Google SERP)
  - SERPAPI (å¤‡ç”¨)
  - ç”¨é€”: ç«äº‰å¯¹æ‰‹åˆ†æ

- ğŸ†• **Publication APIs** (æŒ‰éœ€é…ç½®)
  - WordPress REST API (å¼€æº)
  - Medium API (å…è´¹)
  - Ghost Admin API (å…è´¹)

#### 2. æ•°æ®åº“æ‰©å±•

- âœ… PostgreSQL (å·²æœ‰)
- ğŸ†• éœ€è¦æ·»åŠ æ–°è¡¨:
  - `projects` - é¡¹ç›®ç®¡ç†
  - `keywords` - å…³é”®è¯å­˜å‚¨
  - `content_drafts` - å†…å®¹è‰ç¨¿
  - `images` - å›¾åƒèµ„æº
  - `publications` - å‘å¸ƒè®°å½•
  - `ranking_records` - æ’åè¿½è¸ª

#### 3. å­˜å‚¨

- ğŸ†• **Vercel Blob** æˆ– **Cloudflare R2**
  - ç”¨é€”: å­˜å‚¨ç”Ÿæˆçš„å›¾åƒ
  - æˆæœ¬: ~$0.015/GB/month (R2)

#### 4. å‰ç«¯åº“

- ğŸ†• **çŠ¶æ€ç®¡ç†**: Zustand æˆ– Redux Toolkit
- ğŸ†• **UI ç»„ä»¶åº“**:
  - Shadcn/ui (æ¨è)
  - æˆ–ç»§ç»­ä½¿ç”¨ Lucide React
- ğŸ†• **å®æ—¶æ›´æ–°**: WebSocket æˆ– Server-Sent Events
  - ç”¨äº: ç®¡é“è¿›åº¦æµå¼ä¼ è¾“

---

## åç«¯æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚æŒ–è¯ç•Œé¢  â”‚  â”‚ç”Ÿæˆç•Œé¢  â”‚  â”‚å‘å¸ƒç•Œé¢  â”‚  â”‚è¿½è¸ªç•Œé¢  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                        â†“                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vercel Serverless API                     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         Orchestrator (ç¼–æ’å™¨)                     â”‚      â”‚
â”‚  â”‚  api/agents/_shared/orchestrator.ts              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â†“          â†“          â†“          â†“                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚Agent 1  â”‚ â”‚Agent 2  â”‚ â”‚Agent 3  â”‚ â”‚Agent 4  â”‚         â”‚
â”‚  â”‚SEO      â”‚ â”‚Content  â”‚ â”‚Quality  â”‚ â”‚Image    â”‚         â”‚
â”‚  â”‚Research â”‚ â”‚Writer   â”‚ â”‚Reviewer â”‚ â”‚Creative â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                    â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚     Pipeline Manager (ç®¡é“ç®¡ç†å™¨)             â”‚        â”‚
â”‚  â”‚  8 Steps: Search â†’ Competitor â†’ Keywords     â”‚        â”‚
â”‚  â”‚    â†’ GEO â†’ AIO â†’ Generate â†’ Check â†’ Images  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                     â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚     Publisher (å‘å¸ƒå™¨)                        â”‚        â”‚
â”‚  â”‚  WordPress â”‚ Medium â”‚ Ghost â”‚ Webhook        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    External Services                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚Gemini APIâ”‚ â”‚Nano Banana 2 â”‚ â”‚SERP APIs â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PostgreSQL Database                      â”‚
â”‚  projects â”‚ keywords â”‚ content_drafts â”‚ images â”‚           â”‚
â”‚  publications â”‚ ranking_records â”‚ users (shared)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç ç»„ç»‡ç»“æ„

```
api/
â”œâ”€â”€ agents/                          # AIä»£ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ _shared/
â”‚   â”‚   â”œâ”€â”€ orchestrator.ts         # ä»£ç†ç¼–æ’å™¨
â”‚   â”‚   â”œâ”€â”€ agent-base.ts           # ä»£ç†åŸºç±»
â”‚   â”‚   â””â”€â”€ types.ts                # ä»£ç†ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ seo-researcher.ts           # Agent 1
â”‚   â”œâ”€â”€ content-writer.ts           # Agent 2
â”‚   â”œâ”€â”€ quality-reviewer.ts         # Agent 3
â”‚   â””â”€â”€ image-creative.ts           # Agent 4
â”‚
â”œâ”€â”€ pipeline/                        # å†…å®¹ç®¡é“
â”‚   â”œâ”€â”€ _shared/
â”‚   â”‚   â”œâ”€â”€ pipeline-manager.ts     # ç®¡é“çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ checkpoint.ts           # æ£€æŸ¥ç‚¹/æ¢å¤æœºåˆ¶
â”‚   â”‚   â””â”€â”€ types.ts                # ç®¡é“ç±»å‹
â”‚   â”œâ”€â”€ search-preferences.ts       # Step 1
â”‚   â”œâ”€â”€ competitor-analysis.ts      # Step 2
â”‚   â”œâ”€â”€ keyword-optimization.ts     # Step 3
â”‚   â”œâ”€â”€ geo-optimization.ts         # Step 4
â”‚   â”œâ”€â”€ aio-optimization.ts         # Step 5
â”‚   â”œâ”€â”€ content-generation.ts       # Step 6
â”‚   â”œâ”€â”€ quality-check.ts            # Step 7
â”‚   â””â”€â”€ image-generation.ts         # Step 8
â”‚
â”œâ”€â”€ publish/                         # å‘å¸ƒç³»ç»Ÿ
â”‚   â”œâ”€â”€ configure.ts                # å¹³å°é…ç½®
â”‚   â”œâ”€â”€ execute.ts                  # æ‰§è¡Œå‘å¸ƒ
â”‚   â”œâ”€â”€ history.ts                  # å‘å¸ƒå†å²
â”‚   â”œâ”€â”€ platforms/
â”‚   â”‚   â”œâ”€â”€ wordpress.ts            # WordPressé€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ medium.ts               # Mediumé€‚é…å™¨
â”‚   â”‚   â””â”€â”€ ghost.ts                # Ghosté€‚é…å™¨
â”‚   â””â”€â”€ _shared/
â”‚       â””â”€â”€ publisher-base.ts       # å‘å¸ƒå™¨åŸºç±»
â”‚
â”œâ”€â”€ track/                           # è¿½è¸ªç³»ç»Ÿ
â”‚   â”œâ”€â”€ rankings.ts                 # æ’åè¿½è¸ª
â”‚   â”œâ”€â”€ traffic.ts                  # æµé‡ç»Ÿè®¡
â”‚   â””â”€â”€ citations.ts                # å¼•ç”¨ç›‘æ§
â”‚
â”œâ”€â”€ lib/                             # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ db.ts                       # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ auth.ts                     # è®¤è¯
â”‚   â”œâ”€â”€ storage.ts                  # æ–‡ä»¶å­˜å‚¨ (Blob/R2)
â”‚   â””â”€â”€ queue.ts                    # ä»»åŠ¡é˜Ÿåˆ— (å¯é€‰)
â”‚
â”œâ”€â”€ _shared/                         # å…±äº«å·¥å…·
â”‚   â”œâ”€â”€ gemini.ts                   # Gemini API
â”‚   â”œâ”€â”€ nanobanana.ts               # Nano Banana 2 API
â”‚   â”œâ”€â”€ serp.ts                     # SERP API
â”‚   â”œâ”€â”€ request-handler.ts          # è¯·æ±‚å¤„ç†
â”‚   â””â”€â”€ types.ts                    # å…±äº«ç±»å‹
â”‚
â”œâ”€â”€ agents-orchestrate.ts           # ä¸»å…¥å£API
â””â”€â”€ pipeline-execute.ts             # ç®¡é“æ‰§è¡ŒAPI
```

---

## å…³é”® API ç«¯ç‚¹

### 1. ä»£ç†ç³»ç»Ÿ

#### `POST /api/agents/orchestrate`

ä¸»ç¼–æ’ APIï¼Œæ‰§è¡Œå®Œæ•´çš„å¤šä»£ç†å·¥ä½œæµã€‚

**Request**:

```json
{
  "keyword": "coffee shop marketing",
  "targetLanguage": "en",
  "uiLanguage": "zh",
  "agents": [
    "seo-researcher",
    "content-writer",
    "quality-reviewer",
    "image-creative"
  ],
  "options": {
    "imageCount": 6,
    "qualityThreshold": 80,
    "tone": "professional",
    "wordCount": 2000
  }
}
```

**Response**:

```json
{
  "success": true,
  "pipelineId": "pipe_123abc",
  "status": "completed",
  "results": {
    "seoResearch": { ... },
    "content": { ... },
    "qualityCheck": { ... },
    "images": [ ... ]
  },
  "metrics": {
    "duration": 145, // seconds
    "cost": 0.85, // USD
    "agentCalls": 12
  }
}
```

---

#### `POST /api/agents/seo-researcher`

å•ç‹¬è°ƒç”¨ Agent 1

**Request**:

```json
{
  "keyword": "coffee shop marketing",
  "targetLanguage": "en",
  "targetEngines": ["google", "chatgpt"],
  "location": "New York"
}
```

**Response**:

```json
{
  "success": true,
  "data": {
    "searchPreferences": {
      "google": {
        "rankingFactors": ["backlinks", "content-depth", "page-speed"],
        "optimizationStrategy": "..."
      },
      "chatgpt": {
        "citationPatterns": ["structured-data", "q&a-format"],
        "optimizationStrategy": "..."
      }
    },
    "competitorAnalysis": {
      "top10": [
        {
          "url": "example.com/article",
          "title": "...",
          "structure": ["H1", "H2", "H3"],
          "wordCount": 2500
        }
      ],
      "contentGaps": ["missing local case studies", "no statistics from 2024"]
    },
    "keywords": {
      "primary": "coffee shop marketing",
      "lsi": ["cafe promotion", "coffee advertising"],
      "density": 0.015,
      "placement": [
        { "position": "title", "keyword": "coffee shop marketing" },
        { "position": "h1", "keyword": "coffee shop marketing" }
      ]
    }
  }
}
```

---

#### `POST /api/agents/content-writer`

å•ç‹¬è°ƒç”¨ Agent 2

#### `POST /api/agents/quality-reviewer`

å•ç‹¬è°ƒç”¨ Agent 3

#### `POST /api/agents/image-creative`

å•ç‹¬è°ƒç”¨ Agent 4

---

### 2. å†…å®¹ç®¡é“

#### `POST /api/pipeline/execute`

æ‰§è¡Œå®Œæ•´çš„ 8 æ­¥ç®¡é“

**Request**:

```json
{
  "keyword": "coffee shop marketing",
  "targetLanguage": "en",
  "uiLanguage": "zh",
  "options": {
    "steps": "all", // or [1, 2, 3, 6, 8] for selective steps
    "checkpoint": true, // Enable checkpoint/resume
    "streamProgress": true // SSE for real-time updates
  }
}
```

**Response** (Streaming):

```
data: {"step": 1, "status": "started", "message": "Analyzing search preferences..."}
data: {"step": 1, "status": "completed", "duration": 12}
data: {"step": 2, "status": "started", "message": "Fetching SERP data..."}
...
data: {"step": 8, "status": "completed", "duration": 45}
data: {"status": "completed", "totalDuration": 165, "cost": 0.92}
```

---

### 3. å‘å¸ƒç³» ï¿½ï¿½ï¿½

#### `POST /api/publish/configure`

ä¿å­˜å‘å¸ƒå¹³å°é…ç½®

**Request**:

```json
{
  "platform": "wordpress",
  "name": "My WordPress Blog",
  "credentials": {
    "url": "https://myblog.com",
    "username": "admin",
    "password": "app_password_here"
  },
  "defaults": {
    "status": "draft",
    "categories": ["Marketing"],
    "featuredImage": true
  }
}
```

**Response**:

```json
{
  "success": true,
  "configId": "config_abc123",
  "testConnection": true
}
```

---

#### `POST /api/publish/execute`

æ‰§è¡Œå‘å¸ƒ

**Request**:

```json
{
  "contentDraftId": "draft_xyz",
  "platformConfigId": "config_abc123",
  "options": {
    "status": "publish",
    "scheduledAt": null
  }
}
```

**Response**:

```json
{
  "success": true,
  "publicationId": "pub_456",
  "postUrl": "https://myblog.com/coffee-shop-marketing",
  "platformPostId": "12345"
}
```

---

### 4. è¿½è¸ªç³»ç»Ÿ

#### `POST /api/track/rankings`

è¿½è¸ªå…³é”®è¯æ’å

**Request**:

```json
{
  "keywordIds": ["kw_1", "kw_2"],
  "searchEngines": ["google", "chatgpt"],
  "publicationId": "pub_456"
}
```

**Response**:

```json
{
  "success": true,
  "trackingId": "track_789",
  "results": [
    {
      "keywordId": "kw_1",
      "keyword": "coffee shop marketing",
      "rankings": {
        "google": {
          "position": 12,
          "change": "+3",
          "traffic": 450
        },
        "chatgpt": {
          "citations": 5,
          "change": "+2"
        }
      }
    }
  ]
}
```

---

## æ•°æ®åº“è®¾è®¡

### æ–°å¢è¡¨ç»“æ„

```sql
-- =============================================
-- 1. Projects Table (é¡¹ç›®ç®¡ç†)
-- =============================================
CREATE TABLE projects (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id INTEGER REFERENCES users(id),

  -- åŸºæœ¬ä¿¡æ¯
  name VARCHAR(255) NOT NULL,
  description TEXT,

  -- å…³é”®è¯é…ç½®
  seed_keyword VARCHAR(500),
  target_language VARCHAR(10) DEFAULT 'en',
  location VARCHAR(255), -- For GEO optimization

  -- çŠ¶æ€
  status VARCHAR(50) DEFAULT 'active', -- active, archived, completed

  -- æ—¶é—´æˆ³
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_projects_user ON projects(user_id);
CREATE INDEX idx_projects_status ON projects(status);

-- =============================================
-- 2. Keywords Table (å…³é”®è¯å­˜å‚¨)
-- =============================================
CREATE TABLE keywords (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id UUID REFERENCES projects(id) ON DELETE CASCADE,

  -- å…³é”®è¯ä¿¡æ¯
  keyword VARCHAR(500) NOT NULL,
  translation VARCHAR(500), -- åŸå§‹å…³é”®è¯ï¼ˆå¦‚ä¸­æ–‡ï¼‰
  intent VARCHAR(50), -- informational, transactional, commercial, local

  -- SEOæ•°æ®
  volume INTEGER DEFAULT 0,
  difficulty INTEGER, -- 0-100
  probability VARCHAR(20), -- High, Medium, Low

  -- ç”¨æˆ·é€‰æ‹©
  is_selected BOOLEAN DEFAULT false,
  priority INTEGER DEFAULT 0, -- ä¼˜å…ˆçº§æ’åº

  -- åˆ†æç»“æœ (JSON)
  serp_result_count INTEGER,
  top_domain_type VARCHAR(100),
  reasoning TEXT,
  serp_snippets JSONB,

  -- SE Rankingæ•°æ®
  seranking_data JSONB,

  -- æ—¶é—´æˆ³
  created_at TIMESTAMP DEFAULT NOW(),

  CONSTRAINT unique_project_keyword UNIQUE (project_id, keyword)
);

CREATE INDEX idx_keywords_project ON keywords(project_id);
CREATE INDEX idx_keywords_selected ON keywords(is_selected);
CREATE INDEX idx_keywords_probability ON keywords(probability);

-- =============================================
-- 3. Content Drafts Table (å†…å®¹è‰ç¨¿)
-- =============================================
CREATE TABLE content_drafts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id UUID REFERENCES projects(id) ON DELETE CASCADE,
  keyword_id UUID REFERENCES keywords(id),

  -- åŸºæœ¬ä¿¡æ¯
  title VARCHAR(500),
  slug VARCHAR(500),
  meta_description TEXT,

  -- å†…å®¹
  content TEXT, -- Markdownæ ¼å¼
  html_content TEXT, -- æ¸²æŸ“åçš„HTML

  -- SEOä¼˜åŒ–è®°å½•
  seo_optimizations JSONB, -- å…³é”®è¯ä½ç½®ã€GEOã€AIOç­‰

  -- ç‰ˆæœ¬æ§åˆ¶
  version INTEGER DEFAULT 1,
  parent_version_id UUID REFERENCES content_drafts(id),

  -- çŠ¶æ€
  status VARCHAR(50) DEFAULT 'draft',
  -- draft, reviewing, approved, published, rejected

  -- è´¨é‡è¯„åˆ†
  quality_score INTEGER, -- 0-100
  ai_detection_score INTEGER, -- 0-100 (AIæ¦‚ç‡)
  keyword_density_score INTEGER, -- 0-100
  readability_score JSONB, -- Flesch, grade level

  -- è´¨é‡æ£€æŸ¥ç»“æœ
  quality_checks JSONB, -- è¯¦ç»†æ£€æŸ¥ç»“æœ

  -- æ—¶é—´æˆ³
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  published_at TIMESTAMP
);

CREATE INDEX idx_content_project ON content_drafts(project_id);
CREATE INDEX idx_content_keyword ON content_drafts(keyword_id);
CREATE INDEX idx_content_status ON content_drafts(status);
CREATE INDEX idx_content_quality ON content_drafts(quality_score);

-- =============================================
-- 4. Images Table (å›¾åƒèµ„æº)
-- =============================================
CREATE TABLE images (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  content_draft_id UUID REFERENCES content_drafts(id) ON DELETE CASCADE,

  -- å›¾åƒä¿¡æ¯
  prompt TEXT, -- Nano Banana 2 prompt
  theme VARCHAR(500), -- æå–çš„ä¸»é¢˜
  image_url VARCHAR(1000), -- å­˜å‚¨åœ¨Blob/R2çš„URL

  -- SEO
  alt_text VARCHAR(500),
  caption TEXT,

  -- ä½ç½®
  position INTEGER, -- åœ¨æ–‡ç« ä¸­çš„é¡ºåº
  section_id VARCHAR(100), -- æ’å…¥åˆ°å“ªä¸ªç« èŠ‚

  -- å…ƒæ•°æ®
  metadata JSONB, -- width, height, format, EXIFç­‰

  -- æˆæœ¬
  generation_cost DECIMAL(10, 4), -- USD

  -- æ—¶é—´æˆ³
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_images_draft ON images(content_draft_id);
CREATE INDEX idx_images_position ON images(position);

-- =============================================
-- 5. Platform Configs Table (å‘å¸ƒå¹³å°é…ç½®)
-- =============================================
CREATE TABLE platform_configs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id INTEGER REFERENCES users(id),

  -- å¹³å°ä¿¡æ¯
  platform VARCHAR(100) NOT NULL, -- wordpress, medium, ghost
  name VARCHAR(255), -- ç”¨æˆ·è‡ªå®šä¹‰åç§°

  -- å‡­è¯ (åŠ å¯†å­˜å‚¨)
  credentials JSONB, -- åŠ å¯†çš„å‡­è¯ä¿¡æ¯

  -- é»˜è®¤é…ç½®
  defaults JSONB, -- categories, tags, statusç­‰

  -- çŠ¶æ€
  is_active BOOLEAN DEFAULT true,
  last_tested_at TIMESTAMP,
  test_successful BOOLEAN,

  -- æ—¶é—´æˆ³
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_platform_user ON platform_configs(user_id);
CREATE INDEX idx_platform_active ON platform_configs(is_active);

-- =============================================
-- 6. Publications Table (å‘å¸ƒè®°å½•)
-- =============================================
CREATE TABLE publications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  content_draft_id UUID REFERENCES content_drafts(id),
  platform_config_id UUID REFERENCES platform_configs(id),

  -- å‘å¸ƒä¿¡æ¯
  platform VARCHAR(100), -- wordpress, medium, ghost
  platform_post_id VARCHAR(255), -- å¹³å°è¿”å›çš„post ID
  post_url VARCHAR(1000), -- å‘å¸ƒåçš„URL

  -- çŠ¶æ€
  status VARCHAR(50) DEFAULT 'pending',
  -- pending, published, failed, scheduled

  -- é”™è¯¯ä¿¡æ¯
  error_message TEXT,
  retry_count INTEGER DEFAULT 0,

  -- æ—¶é—´æˆ³
  scheduled_at TIMESTAMP,
  published_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_publications_draft ON publications(content_draft_id);
CREATE INDEX idx_publications_platform ON publications(platform);
CREATE INDEX idx_publications_status ON publications(status);
CREATE INDEX idx_publications_date ON publications(published_at);

-- =============================================
-- 7. Ranking Records Table (æ’åè¿½è¸ª)
-- =============================================
CREATE TABLE ranking_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  keyword_id UUID REFERENCES keywords(id),
  publication_id UUID REFERENCES publications(id),

  -- æœç´¢å¼•æ“
  search_engine VARCHAR(50), -- google, chatgpt, claude, perplexity

  -- æ’åæ•°æ®
  position INTEGER, -- æ’åä½ç½®
  change INTEGER, -- ç›¸æ¯”ä¸Šæ¬¡çš„å˜åŒ–

  -- æµé‡ä¼°ç®—
  traffic INTEGER,
  impressions INTEGER,
  clicks INTEGER,

  -- AIå¼•æ“ç‰¹å®š
  citations INTEGER, -- å¼•ç”¨æ¬¡æ•°
  visibility_score DECIMAL(5, 2), -- å¯è§åº¦è¯„åˆ†

  -- é¢å¤–æ•°æ®
  metadata JSONB,

  -- æ—¶é—´æˆ³
  recorded_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_rankings_keyword ON ranking_records(keyword_id);
CREATE INDEX idx_rankings_publication ON ranking_records(publication_id);
CREATE INDEX idx_rankings_engine ON ranking_records(search_engine);
CREATE INDEX idx_rankings_date ON ranking_records(recorded_at);

-- =============================================
-- 8. Agent Execution Logs (ä»£ç†æ‰§è¡Œæ—¥å¿—)
-- =============================================
CREATE TABLE agent_execution_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id UUID REFERENCES projects(id),
  content_draft_id UUID REFERENCES content_drafts(id),

  -- æ‰§è¡Œä¿¡æ¯
  agent_name VARCHAR(100), -- seo-researcher, content-writerç­‰
  pipeline_step INTEGER, -- 1-8
  execution_id UUID, -- åŒä¸€æ¬¡æ‰§è¡Œçš„logsæœ‰ç›¸åŒçš„ID

  -- è¾“å…¥è¾“å‡º
  input_data JSONB,
  output_data JSONB,

  -- æ‰§è¡Œç»“æœ
  status VARCHAR(50), -- started, completed, failed
  error_message TEXT,

  -- æ€§èƒ½
  duration_ms INTEGER,
  cost_usd DECIMAL(10, 4),
  tokens_used INTEGER,

  -- æ—¶é—´æˆ³
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_agent_logs_project ON agent_execution_logs(project_id);
CREATE INDEX idx_agent_logs_execution ON agent_execution_logs(execution_id);
CREATE INDEX idx_agent_logs_agent ON agent_execution_logs(agent_name);

-- =============================================
-- 9. Pipeline Checkpoints (æ£€æŸ¥ç‚¹)
-- =============================================
CREATE TABLE pipeline_checkpoints (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id UUID REFERENCES projects(id),
  execution_id UUID,

  -- æ£€æŸ¥ç‚¹ä¿¡æ¯
  step_number INTEGER,
  step_name VARCHAR(100),

  -- æ•°æ®å¿«ç…§
  snapshot_data JSONB,

  -- çŠ¶æ€
  status VARCHAR(50), -- in_progress, completed, failed

  -- æ—¶é—´æˆ³
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_checkpoint_execution ON pipeline_checkpoints(execution_id);
CREATE INDEX idx_checkpoint_project ON pipeline_checkpoints(project_id);
```

---

## å®æ–½é˜¶æ®µ

### ğŸ“… Phase 2.1: åŸºç¡€æ¶æ„ (Week 1-2)

**ç›®æ ‡**: æ­å»ºå¤šä»£ç†ç³»ç»Ÿçš„åŸºç¡€è®¾æ–½

#### Week 1: æ•°æ®åº“ & æ ¸å¿ƒåº“

- [x] è®¾è®¡å¹¶åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„
- [ ] å®ç° `api/lib/storage.ts` (å›¾åƒå­˜å‚¨)
- [ ] å®ç° `api/lib/queue.ts` (ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¯é€‰)
- [ ] æ›´æ–° `api/_shared/types.ts` æ·»åŠ æ–°ç±»å‹
- [ ] ç¼–å†™æ•°æ®åº“è¿ç§»è„šæœ¬

**äº¤ä»˜ç‰©**:

- å®Œæ•´çš„æ•°æ®åº“ schema
- å­˜å‚¨å±‚å®ç°
- å•å…ƒæµ‹è¯•

#### Week 2: ä»£ç†åŸºç±» & ç¼–æ’å™¨

- [ ] å®ç° `api/agents/_shared/agent-base.ts`
- [ ] å®ç° `api/agents/_shared/orchestrator.ts`
- [ ] å®ç° `api/pipeline/_shared/pipeline-manager.ts`
- [ ] æ·»åŠ æ£€æŸ¥ç‚¹/æ¢å¤æœºåˆ¶
- [ ] å®ç° SSE è¿›åº¦æµå¼ä¼ è¾“

**äº¤ä»˜ç‰©**:

- ä»£ç†ç³»ç»Ÿæ¡†æ¶
- ç®¡é“ç®¡ç†å™¨
- é›†æˆæµ‹è¯•

---

### ğŸ¤– Phase 2.2: AI ä»£ç†å®ç° (Week 3-4)

**ç›®æ ‡**: å®ç° 4 ä¸ªæ ¸å¿ƒä»£ç†

#### Week 3: Agent 1 & Agent 2

- [ ] **Agent 1: SEO ç ”ç©¶å®˜**

  - [ ] æœç´¢å¼•æ“åå¥½åˆ†æ
  - [ ] SERP æŠ“å–ä¸è§£æ
  - [ ] ç«äº‰å¯¹æ‰‹ç»“æ„æå–
  - [ ] å…³é”®è¯ä¼˜åŒ–å»ºè®®
  - [ ] GEO/AIO å»ºè®®ç”Ÿæˆ

- [ ] **Agent 2: å†…å®¹å†™æ‰‹**
  - [ ] åˆç¨¿ç”Ÿæˆé€»è¾‘
  - [ ] å…³é”®è¯æ³¨å…¥
  - [ ] ç»“æ„éµå¾ª
  - [ ] GEO/AIO åº”ç”¨

**äº¤ä»˜ç‰©**:

- Agent 1 å®Œæ•´å®ç°
- Agent 2 å®Œæ•´å®ç°
- Prompt å·¥ç¨‹æ–‡æ¡£
- ä»£ç†æµ‹è¯•å¥—ä»¶

#### Week 4: Agent 3 & Agent 4

- [ ] **Agent 3: è´¨é‡æŠŠå…³å®˜**

  - [ ] å…³é”®è¯å¯†åº¦æ£€æŸ¥
  - [ ] AI æ£€æµ‹é›†æˆ
  - [ ] GEO/AIO åˆè§„æ€§éªŒè¯
  - [ ] å¯è¯»æ€§è¯„åˆ†
  - [ ] è´¨é‡è¯„åˆ†ç®—æ³•

- [ ] **Agent 4: å›¾æ–‡åˆ›æ„å®˜**
  - [ ] ä¸»é¢˜æå–ç®—æ³•
  - [ ] Nano Banana 2 é›†æˆ
  - [ ] Prompt ç”Ÿæˆå™¨
  - [ ] å¹¶è¡Œå›¾åƒç”Ÿæˆ
  - [ ] å›¾åƒå¤„ç†ä¸å…ƒæ•°æ®

**äº¤ä»˜ç‰©**:

- Agent 3 å®Œæ•´å®ç°
- Agent 4 å®Œæ•´å®ç°
- Nano Banana 2 API å°è£…
- ç«¯åˆ°ç«¯æµ‹è¯•

---

### ğŸ”„ Phase 2.3: å†…å®¹ç®¡é“ (Week 5)

**ç›®æ ‡**: å®ç° 8 æ­¥å†…å®¹åˆ›ä½œæµç¨‹

- [ ] **Step 1**: æœç´¢å¼•æ“åå¥½åˆ†æ API
- [ ] **Step 2**: ç«äº‰å¯¹æ‰‹åˆ†æ API
- [ ] **Step 3**: å…³é”®è¯ä¼˜åŒ– API
- [ ] **Step 4**: GEO ä¼˜åŒ– API
- [ ] **Step 5**: AIO ä¼˜åŒ– API
- [ ] **Step 6**: å†…å®¹ç”Ÿæˆ API
- [ ] **Step 7**: è´¨é‡æ£€æŸ¥ API
- [ ] **Step 8**: å›¾åƒç”Ÿæˆ API

**äº¤ä»˜ç‰©**:

- 8 ä¸ªç‹¬ç«‹ API ç«¯ç‚¹
- å®Œæ•´ç®¡é“æ‰§è¡Œå™¨
- ç®¡é“çŠ¶æ€ç®¡ç†
- æ€§èƒ½ä¼˜åŒ–

---

### ğŸ“¤ Phase 2.4: å‘å¸ƒç³»ç»Ÿ (Week 6)

**ç›®æ ‡**: å®ç°å¤šå¹³å°å‘å¸ƒåŠŸèƒ½

- [ ] **å¹³å°é€‚é…å™¨**

  - [ ] WordPress REST API é€‚é…å™¨
  - [ ] Medium API é€‚é…å™¨
  - [ ] Ghost Admin API é€‚é…å™¨

- [ ] **å‘å¸ƒæ ¸å¿ƒ**

  - [ ] å¹³å°é…ç½®ç®¡ç†
  - [ ] å‡­è¯åŠ å¯†å­˜å‚¨
  - [ ] å‘å¸ƒæ‰§è¡Œå¼•æ“
  - [ ] é”™è¯¯å¤„ç†ä¸é‡è¯•

- [ ] **API ç«¯ç‚¹**
  - [ ] `POST /api/publish/configure`
  - [ ] `POST /api/publish/execute`
  - [ ] `GET /api/publish/history`

**äº¤ä»˜ç‰©**:

- 3 ä¸ªå¹³å°é€‚é…å™¨
- å‘å¸ƒç³»ç»Ÿ API
- å¹³å°æµ‹è¯•å¥—ä»¶

---

### ğŸ“Š Phase 2.5: è¿½è¸ªç³»ç»Ÿ (Week 7, Optional)

**ç›®æ ‡**: å®ç°æ’åè¿½è¸ªåŠŸèƒ½

- [ ] **æ’åç›‘æ§**

  - [ ] Google æ’åæ£€æŸ¥ (SERP API)
  - [ ] ChatGPT å¼•ç”¨æ£€æŸ¥
  - [ ] æµé‡ä¼°ç®—

- [ ] **æ•°æ®å­˜å‚¨**

  - [ ] æ’åå†å²è®°å½•
  - [ ] è¶‹åŠ¿åˆ†æ

- [ ] **API ç«¯ç‚¹**
  - [ ] `POST /api/track/rankings`
  - [ ] `GET /api/track/history`
  - [ ] `GET /api/track/trends`

**äº¤ä»˜ç‰©**:

- æ’åè¿½è¸ªç³»ç»Ÿ
- å†å²æ•°æ® API
- æŠ¥å‘Šç”Ÿæˆå™¨

---

### ğŸ¨ Phase 2.6: å‰ç«¯é‡æ„ (Week 7-8)

**ç›®æ ‡**: é‡æ„ App.tsxï¼Œå®ç°æ¨¡å—åŒ– UI

#### Week 7: ç»„ä»¶æ‹†åˆ†

- [ ] æ‹†åˆ† `App.tsx` ä¸ºæ¨¡å—åŒ–ç»„ä»¶
- [ ] åˆ›å»ºå·¥ä½œæµ UI ç»„ä»¶
  - [ ] `components/workflow/PipelineProgress.tsx`
  - [ ] `components/workflow/AgentStatus.tsx`
  - [ ] `components/workflow/StepTimeline.tsx`
- [ ] åˆ›å»ºå†…å®¹ç¼–è¾‘ç»„ä»¶
  - [ ] `components/content-editor/ContentPreview.tsx`
  - [ ] `components/content-editor/ImageGallery.tsx`
  - [ ] `components/content-editor/MetricsPanel.tsx`
- [ ] åˆ›å»ºå‘å¸ƒç»„ä»¶
  - [ ] `components/publication/PlatformConfig.tsx`
  - [ ] `components/publication/PublishButton.tsx`

#### Week 8: çŠ¶æ€ç®¡ç† & é›†æˆ

- [ ] å®ç°çŠ¶æ€ç®¡ç† (Zustand)
- [ ] å®ç° SSE è¿›åº¦ç›‘å¬
- [ ] æ·»åŠ é”™è¯¯è¾¹ç•Œ
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å“åº”å¼è®¾è®¡

**äº¤ä»˜ç‰©**:

- æ¨¡å—åŒ–ç»„ä»¶åº“
- çŠ¶æ€ç®¡ç†æ¶æ„
- é›†æˆæµ‹è¯•
- ç”¨æˆ·æµ‹è¯•

---

### ğŸ§ª Phase 2.7: æµ‹è¯•ä¸ä¼˜åŒ– (Week 8)

**ç›®æ ‡**: å…¨é¢æµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–

- [ ] **å•å…ƒæµ‹è¯•**

  - [ ] æ‰€æœ‰ä»£ç†æµ‹è¯•
  - [ ] ç®¡é“æµ‹è¯•
  - [ ] API æµ‹è¯•

- [ ] **é›†æˆæµ‹è¯•**

  - [ ] ç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•
  - [ ] å¹³å°å‘å¸ƒæµ‹è¯•
  - [ ] é”™è¯¯æ¢å¤æµ‹è¯•

- [ ] **æ€§èƒ½ä¼˜åŒ–**

  - [ ] API å“åº”æ—¶é—´ä¼˜åŒ–
  - [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
  - [ ] å‰ç«¯æ¸²æŸ“ä¼˜åŒ–

- [ ] **æ–‡æ¡£**
  - [ ] API æ–‡æ¡£æ›´æ–°
  - [ ] ç”¨æˆ·æŒ‡å—
  - [ ] å¼€å‘è€…æ–‡æ¡£

**äº¤ä»˜ç‰©**:

- æµ‹è¯•è¦†ç›–ç‡ > 80%
- æ€§èƒ½åŸºå‡†æŠ¥å‘Š
- å®Œæ•´æ–‡æ¡£

---

## æŠ€æœ¯é£é™©ä¸æŒ‘æˆ˜

### ğŸ”´ é«˜é£é™©

1. **Vercel 60 ç§’è¶…æ—¶é™åˆ¶**

   - **é£é™©**: å®Œæ•´ç®¡é“å¯èƒ½è¶…è¿‡ 60 ç§’
   - **ç¼“è§£**:
     - å®ç°æ£€æŸ¥ç‚¹/æ¢å¤æœºåˆ¶
     - æ‹†åˆ†ä¸ºå¤šä¸ª API è°ƒç”¨
     - ä½¿ç”¨ Vercel Cron Jobs å¤„ç†åå°ä»»åŠ¡
     - è€ƒè™‘è¿ç§»åˆ°é•¿æ—¶é—´è¿è¡Œç¯å¢ƒ (Vercel Jobs)

2. **Nano Banana 2 API ç¨³å®šæ€§**

   - **é£é™©**: ç¬¬ä¸‰æ–¹ API å¯èƒ½ä¸ç¨³å®š
   - **ç¼“è§£**:
     - å®ç°é‡è¯•æœºåˆ¶
     - æ·»åŠ å¤‡ç”¨å›¾åƒæº (DALL-E, Midjourney)
     - å›¾åƒç”Ÿæˆå¤±è´¥æ—¶ç»§ç»­æµç¨‹

3. **AI æ£€æµ‹å‡†ç¡®æ€§**
   - **é£é™©**: AI æ¦‚ç‡æ£€æµ‹å¯èƒ½ä¸å‡†ç¡®
   - **ç¼“è§£**:
     - ä½¿ç”¨å¤šä¸ªæ£€æµ‹æ–¹æ³•äº¤å‰éªŒè¯
     - è°ƒæ•´æ£€æµ‹é˜ˆå€¼
     - äººå·¥å®¡æ ¸ä½œä¸ºåå¤‡

---

### ğŸŸ¡ ä¸­ç­‰é£é™©

4. **SERP API é™æµ**

   - **é£é™©**: ç«äº‰å¯¹æ‰‹åˆ†æå¯èƒ½å— API é™åˆ¶
   - **ç¼“è§£**:
     - å®ç°è¯·æ±‚é˜Ÿåˆ—å’Œé€Ÿç‡é™åˆ¶
     - ç¼“å­˜ SERP ç»“æœ
     - é™ä½åˆ†æé¢‘ç‡

5. **å¤§æ–‡ä»¶å¤„ç†**

   - **é£é™©**: å†…å®¹è‰ç¨¿ + å›¾åƒå¯èƒ½å¾ˆå¤§
   - **ç¼“è§£**:
     - å›¾åƒå•ç‹¬å­˜å‚¨ (Blob/R2)
     - å†…å®¹åˆ†é¡µä¼ è¾“
     - å‹ç¼©å­˜å‚¨

6. **å¹³å° API å˜æ›´**
   - **é£é™©**: WordPress/Medium/Ghost API å¯èƒ½å˜æ›´
   - **ç¼“è§£**:
     - ç‰ˆæœ¬åŒ– API é€‚é…å™¨
     - å®šæœŸæµ‹è¯•å¹³å°è¿æ¥
     - å¿«é€Ÿå“åº”æœºåˆ¶

---

### ğŸŸ¢ ä½é£é™©

7. **æ•°æ®åº“æ€§èƒ½**

   - **é£é™©**: å¤§é‡æ’åè¿½è¸ªè®°å½•å¯èƒ½å½±å“æ€§èƒ½
   - **ç¼“è§£**:
     - å®šæœŸå½’æ¡£æ—§æ•°æ®
     - æ·»åŠ é€‚å½“ç´¢å¼•
     - åˆ†åŒºè¡¨ (æŒ‰æ—¶é—´)

8. **å‰ç«¯å¤æ‚åº¦**
   - **é£é™©**: æ¨¡å—åŒ–é‡æ„å¯èƒ½å¼•å…¥ bug
   - **ç¼“è§£**:
     - æ¸è¿›å¼é‡æ„
     - å®Œæ•´çš„å•å…ƒæµ‹è¯•
     - E2E æµ‹è¯•

---

#

### è¿è¥æˆæœ¬ï¼ˆæ¯ç¯‡æ–‡ç« ï¼‰

| é¡¹ç›®               | å•ä»·               | æ•°é‡           | å°è®¡            |
| ------------------ | ------------------ | -------------- | --------------- |
| Gemini API (Flash) | $0.002/1K tokens   | ~100K tokens   | $0.20           |
| Nano Banana 2      | $0.06/image        | 5 images       | $0.30           |
| SERP API           | $0.001/request     | 15 requests    | $0.015          |
| Vercel Serverless  | $0.0002/invocation | 20 invocations | $0.004          |
| Vercel Blob å­˜å‚¨   | $0.015/GB          | 0.05 GB        | $0.00075        |
| **æ€»è®¡**           | -                  | -              | **~$0.52/æ–‡ç« ** |

---

### æœˆåº¦è¿è¥æˆæœ¬ï¼ˆå‡è®¾ 100 ç¯‡æ–‡ç« /æœˆï¼‰

| é¡¹ç›®                          | æˆæœ¬        |
| ----------------------------- | ----------- |
| AI API (Gemini + Nano Banana) | $50         |
| Vercel Hobby Pro              | $20         |
| Vercel Blob (1GB)             | $0.015      |
| SERP API (1500 requests)      | $1.50       |
| Database (Supabase/Neon)      | $25         |
| **æ€»è®¡**                      | **~$97/æœˆ** |

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹

1. **è·å– API å¯†é’¥**

   - [ ] æ³¨å†Œ Nano Banana 2 è´¦å·
   - [ ] è·å– SERP API å¯†é’¥ (Serper æˆ– SERPAPI)
   - [ ] é…ç½® Vercel Blob å­˜å‚¨

2. **æ•°æ®åº“å‡†å¤‡**

   - [ ] è¿è¡Œè¿ç§»è„šæœ¬åˆ›å»ºæ–°è¡¨
   - [ ] å¤‡ä»½ç°æœ‰æ•°æ®

3. **ç¯å¢ƒå˜é‡é…ç½®**

   - [ ] æ·»åŠ æ–° API å¯†é’¥åˆ° `.env`
   - [ ] æ›´æ–° Vercel ç¯å¢ƒå˜é‡

4. **å¼€å§‹ Phase 2.1**
   - [ ] åˆ›å»º `api/lib/storage.ts`
   - [ ] å®ç°ä»£ç†åŸºç±»
   - [ ] å®ç°ç¼–æ’å™¨

---

## å‚è€ƒèµ„æ–™

### Nano Banana 2 API æ–‡æ¡£

- ç½‘ç«™: https://nanobanana.com
- API æ–‡æ¡£: [å¾…è·å–]

### SERP APIs

- Serper: https://serper.dev
- SERPAPI: https://serpapi.com

### å¹³å° APIs

- WordPress REST API: https://developer.wordpress.org/rest-api/
- Medium API: https://github.com/Medium/medium-api-docs
- Ghost Admin API: https://ghost.org/docs/admin-api/

---

## é™„å½•: Prompt å·¥ç¨‹ç¤ºä¾‹

### Agent 1: SEO ç ”ç©¶å‘˜ Prompt

```markdown
You are an expert SEO Researcher with deep knowledge of how different search engines rank and display content.

## Your Task

Analyze the keyword "{keyword}" and provide comprehensive SEO recommendations.

## Requirements

1. Search Engine Preferences

   - Analyze ranking factors for: Google, ChatGPT, Claude, Perplexity
   - Identify differences in content preferences

2. Competitor Analysis

   - Fetch Top 10 SERP results for "{keyword}"
   - Extract content structure (H1, H2, H3 hierarchy)
   - Identify common patterns and frameworks
   - Find content gaps and opportunities

3. Keyword Optimization

   - Primary keyword: "{keyword}"
   - Extract 5-10 LSI keywords
   - Recommend keyword density (1-2%)
   - Plan optimal keyword placement

4. GEO Optimization (for location: {location})

   - Suggest local references and landmarks
   - Identify regional data sources
   - Recommend localized language

5. AIO Optimization
   - Suggest Q&A sections
   - Identify structured data opportunities
   - Recommend AI-friendly content structures

## Output Format

Return a JSON object with the following structure:
{
"searchPreferences": { ... },
"competitorAnalysis": { ... },
"keywords": { ... },
"geoRecommendations": [ ... ],
"aioRecommendations": [ ... ]
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-01-01
**ç»´æŠ¤è€…**: Claude Code

---

> ğŸ’¡ **æç¤º**: æœ¬æ–‡æ¡£æ˜¯ä¸€ä¸ªåŠ¨æ€è®¡åˆ’ï¼Œå°†æ ¹æ®å®æ–½è¿‡ç¨‹ä¸­çš„å‘ç°å’Œåé¦ˆæŒç»­æ›´æ–°ã€‚
