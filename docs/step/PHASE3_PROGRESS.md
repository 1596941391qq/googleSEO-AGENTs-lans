# Phase 3 å®æ–½è¿›åº¦è·Ÿè¸ª

**å¼€å§‹æ—¶é—´**: 2026-01-02
**çŠ¶æ€**: è¿›è¡Œä¸­
**ç›®æ ‡**: å¤šç½‘ç«™ç®¡ç†ã€Website Data å¢å¼ºã€GEO è¿½è¸ª

---

## Phase 3.1: å¤šç½‘ç«™ç®¡ç† (3-4 å¤©)

- [x] Task 1.1: æ•°æ®åº“è¿ç§»
- [x] Task 1.2: API ç«¯ç‚¹å®ç°
- [x] Task 1.3: å‰ç«¯ UI ç»„ä»¶
- [x] Task 1.4: é›†æˆæµ‹è¯•

**å®Œæˆæ—¶é—´**: 2026-01-02

**å®æ–½è¯¦æƒ…**:

**Task 1.1: æ•°æ®åº“è¿ç§»** âœ…
- åˆ›å»º `api/migrations/phase3-multi-website.ts`
- æ·»åŠ  `user_websites` è¡¨å­—æ®µï¼š`is_default`, `last_accessed_at`
- åˆ›å»º `user_preferences` è¡¨
- åˆ›å»ºç´¢å¼•ä¼˜åŒ–

**Task 1.2: API ç«¯ç‚¹å®ç°** âœ…
- `/api/websites/list` - è·å–ç”¨æˆ·ç½‘ç«™åˆ—è¡¨
- `/api/websites/set-default` - è®¾ç½®é»˜è®¤ç½‘ç«™
- `/api/websites/delete` - åˆ é™¤ç½‘ç«™

**Task 1.3: å‰ç«¯ UI ç»„ä»¶** âœ…
- åˆ›å»º `components/WebsiteManager.tsx` - ç½‘ç«™ç®¡ç†ç»„ä»¶
- åˆ›å»º `WebsiteCard` å­ç»„ä»¶
- å®ç°ç½‘ç«™åˆ—è¡¨å±•ç¤º
- å®ç°è®¾ç½®é»˜è®¤ç½‘ç«™åŠŸèƒ½
- å®ç°åˆ é™¤ç½‘ç«™åŠŸèƒ½

**Task 1.4: é›†æˆæµ‹è¯•** âœ…
- æ›´æ–° `ContentGenerationView.tsx`
- ä¼˜å…ˆä»æ•°æ®åº“åŠ è½½ç½‘ç«™
- localStorage ä½œä¸ºåå¤‡æ–¹æ¡ˆ
- é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ¢å¤ç»‘å®šçŠ¶æ€

---

## Phase 3.2: Website Data å¢å¼º (7-10 å¤©)

- [x] Task 2.1: SE-Ranking Domain API å·¥å…·å±‚
- [x] Task 2.2: æ•°æ®åº“ç¼“å­˜è¡¨
- [x] Task 2.3: API ç«¯ç‚¹å®ç°
- [x] Task 2.4: å‰ç«¯ä»ªè¡¨ç›˜ UI

**å®Œæˆæ—¶é—´**: 2026-01-03

---

## Phase 3.3: GEO è¿½è¸ªåŠŸèƒ½ (5-7 å¤©)

- [x] Task 3.1: æ•°æ®åº“è¡¨åˆ›å»º
- [x] Task 3.2: API ç«¯ç‚¹å®ç°
- [x] Task 3.3: å‰ç«¯ UI å®ç°

**å®Œæˆæ—¶é—´**: 2026-01-03

---

## å®æ–½æ—¥å¿—

### 2026-01-03

**Phase 3.3 å®Œæˆ** âœ…

**Task 3.1: æ•°æ®åº“è¡¨åˆ›å»º** âœ…
- åœ¨ `api/lib/database.ts` ä¸­æ·»åŠ  `initGeoTables()` å‡½æ•°
- åˆ›å»º `geo_rankings` è¡¨ - å­˜å‚¨å…³é”®è¯åœ¨ä¸åŒåœ°ç†ä½ç½®çš„æ’åæ•°æ®
  - æ”¯æŒ country_code, region, city ä¸‰çº§åœ°ç†ä½ç½®
  - è®°å½• current_position, previous_position, position_change
  - è®°å½• local_traffic æµé‡ä¼°ç®—
  - å”¯ä¸€çº¦æŸç¡®ä¿åŒä¸€å…³é”®è¯åœ¨åŒä¸€ä½ç½®åªè®°å½•ä¸€æ¬¡
- åˆ›å»º `geo_opportunities` è¡¨ - å­˜å‚¨ GEO ä¼˜åŒ–æœºä¼š
  - è®°å½•ç›®æ ‡ä½ç½®å’Œå½“å‰/æ½œåœ¨æ’å
  - ä¼°ç®—æµé‡å¢é•¿ (estimated_traffic_gain)
  - éš¾åº¦è¯„ä¼° (difficulty_score, effort_required)
  - ä¼˜åŒ–å»ºè®® (optimization_suggestions)
  - çŠ¶æ€è¿½è¸ª (status: pending/in_progress/completed)

**Task 3.2: API ç«¯ç‚¹å®ç°** âœ…
- `/api/geo/rankings` - è·å–å…³é”®è¯çš„ GEO æ’åæ•°æ®
  - æ”¯æŒæŒ‰ websiteId, keywordId, countryCode ç­›é€‰
  - è¿”å›æ’ååˆ—è¡¨å’ŒæŒ‰å›½å®¶åˆ†ç»„çš„ç»Ÿè®¡
  - åŒ…å« Top 10, Top 3 è®¡æ•°å’Œå¹³å‡æ’å
- `/api/geo/compare` - å¯¹æ¯”ä¸åŒåœ°åŒºçš„æ’åè¡¨ç°
  - æ”¯æŒå¯¹æ¯”å¤šä¸ªæŒ‡å®šåœ°åŒºçš„æ’å
  - è‡ªåŠ¨è¯†åˆ«è¡¨ç°æœ€å¥½/æœ€å·®çš„åœ°åŒº
  - è®¡ç®—å¹³å‡æ’åå’Œæ’åæ³¢åŠ¨èŒƒå›´
  - æ±‡æ€»æœ¬åœ°æµé‡æ•°æ®
- `/api/geo/opportunities` - å‘ç°åœ°ç†æ’åæœºä¼š
  - æ”¯æŒæŒ‰å›½å®¶ã€æœ€å°æ’åå·®è·ã€æœ€å¤§éš¾åº¦ã€çŠ¶æ€ç­›é€‰
  - è¿”å›æ½œåœ¨ä¼˜åŒ–æœºä¼šåˆ—è¡¨
  - ç»Ÿè®¡æ‘˜è¦ï¼ˆæ€»æ•°ã€æ½œåœ¨æµé‡ã€å¹³å‡éš¾åº¦ï¼‰
  - æŒ‰å›½å®¶åˆ†ç»„ç»Ÿè®¡æœºä¼š

**Task 3.3: å‰ç«¯ UI å®ç°** âœ…
- åˆ›å»º `components/geo/GeoRankingsView.tsx`
  - æ˜¾ç¤ºå…³é”®è¯åœ¨ä¸åŒåœ°ç†ä½ç½®çš„æ’å
  - æŒ‰å›½å®¶åˆ†ç»„ç»Ÿè®¡å¡ç‰‡ï¼ˆTop 10/3 è®¡æ•°ã€å¹³å‡æ’åï¼‰
  - æ’ååˆ—è¡¨å¸¦ä½ç½®å˜åŒ–æŒ‡ç¤ºå™¨
  - æ”¯æŒæŒ‰å›½å®¶å’Œå…³é”®è¯ç­›é€‰
- åˆ›å»º `components/geo/GeoOpportunitiesView.tsx`
  - æ¦‚è§ˆç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»æœºä¼šã€æ½œåœ¨æµé‡ã€å¹³å‡éš¾åº¦ã€å¾…å¤„ç†æ•°ï¼‰
  - çŠ¶æ€ç­›é€‰æŒ‰é’®ï¼ˆå…¨éƒ¨/å¾…å¤„ç†/è¿›è¡Œä¸­/å·²å®Œæˆï¼‰
  - æœºä¼šå¡ç‰‡åˆ—è¡¨
  - æ˜¾ç¤ºå½“å‰æ’åã€æ½œåœ¨æ’åã€æ’åå·®è·ã€æµé‡å¢é•¿
  - ä¼˜åŒ–å»ºè®®å±•ç¤º
  - "å¼€å§‹ä¼˜åŒ–"æ“ä½œæŒ‰é’®
- åˆ›å»º `components/geo/index.ts` - å¯¼å‡ºæ‰€æœ‰ GEO ç»„ä»¶

**Phase 3.3 å®Œæˆ** âœ… (2026-01-03)

**ä¸‹ä¸€æ­¥**: Phase 3 å…¨éƒ¨å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•å’Œä¼˜åŒ–ï¼Œæˆ–è¿›å…¥ Phase 4 å¼€å‘

---

## Phase 3 å®Œæˆæ€»ï¿½ï¿½ï¿½

**Phase 3.1 å®Œæˆ** âœ…

**Task 1.1: æ•°æ®åº“è¿ç§»** âœ…
- åˆ›å»ºè¿ç§»è„šæœ¬ `/api/migrations/phase3-multi-website.ts`
- æ‰©å±• `user_websites` è¡¨ï¼šæ·»åŠ  `is_default` å’Œ `last_accessed_at` å­—æ®µ
- åˆ›å»º `user_preferences` è¡¨ç”¨äºå­˜å‚¨ç”¨æˆ·åå¥½
- åˆ›å»ºå”¯ä¸€ç´¢å¼•ç¡®ä¿æ¯ä¸ªç”¨æˆ·åªæœ‰ä¸€ä¸ªé»˜è®¤ç½‘ç«™
- ä¸ºå·²æœ‰ç”¨æˆ·åˆ›å»ºé»˜è®¤åå¥½è®¾ç½®

**Task 1.2: API ç«¯ç‚¹å®ç°** âœ…
- `/api/websites/list` - è·å–ç”¨æˆ·ç½‘ç«™åˆ—è¡¨
  - è¿”å›æ‰€æœ‰æ´»è·ƒç½‘ç«™
  - åŒ…å«é»˜è®¤ç½‘ç«™å’Œæœ€åé€‰æ‹©ç½‘ç«™ä¿¡æ¯
  - è‡ªåŠ¨æ›´æ–°æœ€åè®¿é—®æ—¶é—´
- `/api/websites/set-default` - è®¾ç½®é»˜è®¤ç½‘ç«™
  - è‡ªåŠ¨å–æ¶ˆå…¶ä»–ç½‘ç«™çš„é»˜è®¤çŠ¶æ€
  - æ›´æ–°ç”¨æˆ·åå¥½è®¾ç½®
- `/api/websites/delete` - åˆ é™¤ç½‘ç«™
  - è½¯åˆ é™¤ï¼ˆè®¾ç½® is_active = falseï¼‰
  - å¦‚æœåˆ é™¤é»˜è®¤ç½‘ç«™ï¼Œè‡ªåŠ¨è®¾ç½®æ–°çš„é»˜è®¤ç½‘ç«™

**Task 1.3: å‰ç«¯ UI ç»„ä»¶** âœ…
- åˆ›å»º `components/WebsiteManager.tsx`
  - ç½‘ç«™åˆ—è¡¨å±•ç¤º
  - é»˜è®¤ç½‘ç«™æ ‡è®°
  - è®¾ç½®é»˜è®¤ç½‘ç«™åŠŸèƒ½
  - åˆ é™¤ç½‘ç«™åŠŸèƒ½
  - å“åº”å¼è®¾è®¡
- åˆ›å»º `WebsiteCard` å­ç»„ä»¶
  - ç½‘ç«™ä¿¡æ¯å±•ç¤º
  - æœ€åè®¿é—®æ—¶é—´æ˜¾ç¤º
  - æ“ä½œæŒ‰é’®ï¼ˆè®¾ä¸ºé»˜è®¤ã€åˆ é™¤ï¼‰

**Task 1.4: é›†æˆæµ‹è¯•** âœ…
- æ›´æ–° `ContentGenerationView.tsx`
  - ä¼˜å…ˆä»æ•°æ®åº“åŠ è½½ç½‘ç«™
  - localStorage ä½œä¸ºåå¤‡æ–¹æ¡ˆ
  - ä¼˜é›…çš„é”™è¯¯å¤„ç†

**Phase 3.2 å¼€å§‹** ğŸš€

**Task 2.1: SE-Ranking Domain API å·¥å…·å±‚** âœ…
- åˆ›å»º `api/_shared/tools/se-ranking-domain.ts`
- å®ç° `getDomainOverview` - è·å–åŸŸåæ¦‚è§ˆ
- å®ç° `getDomainKeywords` - è·å–å…³é”®è¯æ’ååˆ—è¡¨
- å®ç° `getDomainRankingHistory` - è·å–æ’åå†å²è¶‹åŠ¿
- å®ç° `getDomainCompetitors` - è·å–ç«äº‰å¯¹æ‰‹å¯¹æ¯”
- å®ç° `getAllDomainData` - æ‰¹é‡è·å–æ‰€æœ‰æ•°æ®

**Task 2.2: æ•°æ®åº“ç¼“å­˜è¡¨** âœ…
- åˆ›å»ºè¿ç§»è„šæœ¬ `/api/migrations/phase3-website-data.ts`
- åˆ›å»º `domain_overview_cache` è¡¨ - ç¼“å­˜åŸŸåæ¦‚è§ˆ
- åˆ›å»º `domain_keywords_cache` è¡¨ - ç¼“å­˜å…³é”®è¯æ’å
- åˆ›å»º `domain_competitors_cache` è¡¨ - ç¼“å­˜ç«äº‰å¯¹æ‰‹
- æ·»åŠ ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

**Task 2.3: Website Data API ç«¯ç‚¹** âœ…
- `/api/website-data/update-metrics` - æ›´æ–°ç½‘ç«™æŒ‡æ ‡
  - è°ƒç”¨ SE-Ranking Domain API
  - ç¼“å­˜æ•°æ®åˆ°æ•°æ®åº“
- `/api/website-data/overview` - è·å–ç½‘ç«™æ¦‚è§ˆ
  - ä»ç¼“å­˜è¯»å–æ•°æ®
  - è‡ªåŠ¨åˆ·æ–°è¿‡æœŸç¼“å­˜
  - è¿”å›ä»ªè¡¨ç›˜æ•°æ®

**Task 2.4: å‰ç«¯ä»ªè¡¨ç›˜ UI** âœ…
- åˆ›å»º `components/website-data/OverviewCards.tsx` - æµé‡æŒ‡æ ‡å¡ç‰‡
  - Organic Traffic - æœ‰æœºæµé‡
  - Total Keywords - æ€»å…³é”®è¯æ•°
  - Avg Position - å¹³å‡æ’å
  - Improved - æå‡çš„å…³é”®è¯
  - New - æ–°å¢å…³é”®è¯
- åˆ›å»º `components/website-data/RankingDistributionChart.tsx` - æ’ååˆ†å¸ƒå›¾
  - Top 3, Top 10, Top 50, Top 100 è¿›åº¦æ¡æ˜¾ç¤º
  - ç™¾åˆ†æ¯”è®¡ç®—å’Œå¯è§†åŒ–
- åˆ›å»º `components/website-data/TopKeywordsTable.tsx` - Top å…³é”®è¯è¡¨æ ¼
  - å…³é”®è¯æ’åã€å˜åŒ–ã€æœç´¢é‡ã€CPCã€éš¾åº¦
  - é¢œè‰²ç¼–ç éš¾åº¦å¾½ç« ï¼ˆç»¿è‰²/é»„è‰²/çº¢è‰²ï¼‰
  - ä½ç½®å˜åŒ–å›¾æ ‡ï¼ˆä¸Šå‡/ä¸‹é™ç®­å¤´ï¼‰
- åˆ›å»º `components/website-data/CompetitorsComparison.tsx` - ç«äº‰å¯¹æ‰‹å¯¹æ¯”
  - å…±åŒå…³é”®è¯ã€æœ‰æœºæµé‡ã€å·®è·å…³é”®è¯ã€æ€»å…³é”®è¯
  - ç½‘ç«™å¡ç‰‡å±•ç¤º
- åˆ›å»º `components/website-data/WebsiteDataDashboard.tsx` - ä¸»ä»ªè¡¨ç›˜ç»„ä»¶
  - æ•°æ®åŠ è½½å’Œåˆ·æ–°
  - é”™è¯¯å¤„ç†
  - å“åº”å¼å¸ƒå±€
  - è‡ªåŠ¨åˆ·æ–°è¿‡æœŸç¼“å­˜
- æ›´æ–° `ContentGenerationView.tsx`
  - é›†æˆ WebsiteDataDashboard åˆ° Website Data Tab
  - æ¸…ç†æ—§ä»£ç å®ç°

**Phase 3.2 å®Œæˆ** âœ… (2026-01-03)

**ä¸‹ä¸€æ­¥**: å‡†å¤‡å¼€å§‹ Phase 3.3: GEO è¿½è¸ªåŠŸèƒ½

---

## Phase 3 å®Œæˆæ€»ç»“

**å®Œæˆæ—¶é—´**: 2026-01-03
**çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆ

### å„é˜¶æ®µå®Œæˆæƒ…å†µ

#### Phase 3.1: å¤šç½‘ç«™ç®¡ç† âœ…
- æ•°æ®åº“è¿ç§»ï¼ˆuser_preferences, is_default, last_accessed_atï¼‰
- API ç«¯ç‚¹ï¼ˆlist, set-default, deleteï¼‰
- å‰ç«¯ UIï¼ˆWebsiteManager ç»„ä»¶ï¼‰
- é›†æˆæµ‹è¯•ï¼ˆæ•°æ®åº“ä¼˜å…ˆåŠ è½½ï¼‰

#### Phase 3.2: Website Data å¢å¼º âœ…
- SE-Ranking Domain API å·¥å…·å±‚
- æ•°æ®åº“ç¼“å­˜è¡¨ï¼ˆ3ä¸ªç¼“å­˜è¡¨ + ç´¢å¼•ï¼‰
- API ç«¯ç‚¹ï¼ˆupdate-metrics, overviewï¼‰
- å‰ç«¯ä»ªè¡¨ç›˜ UIï¼ˆ5ä¸ªç»„ä»¶ï¼‰

#### Phase 3.3: GEO è¿½è¸ªåŠŸèƒ½ âœ…
- æ•°æ®åº“è¡¨ï¼ˆgeo_rankings, geo_opportunities + ç´¢å¼•ï¼‰
- API ç«¯ç‚¹ï¼ˆrankings, compare, opportunitiesï¼‰
- å‰ç«¯ UIï¼ˆGeoRankingsView, GeoOpportunitiesViewï¼‰

### éªŒæ”¶æ ‡å‡†è¾¾æˆ

**Phase 3.1** âœ… å…¨éƒ¨è¾¾æˆ
- âœ… ç”¨æˆ·å¯ä»¥æ·»åŠ å¤šä¸ªç½‘ç«™
- âœ… é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ¢å¤ä¸Šæ¬¡é€‰æ‹©çš„ç½‘ç«™
- âœ… ç”¨æˆ·å¯ä»¥è®¾ç½®é»˜è®¤ç½‘ç«™
- âœ… ç”¨æˆ·å¯ä»¥åˆ é™¤ä¸éœ€è¦çš„ç½‘ç«™
- âœ… æ‰€æœ‰æ“ä½œæŒä¹…åŒ–åˆ°æ•°æ®åº“

**Phase 3.2** âœ… å…¨éƒ¨è¾¾æˆ
- âœ… æ˜¾ç¤ºç½‘ç«™æ¦‚è§ˆæ•°æ®
- âœ… æ˜¾ç¤ºæ’ååˆ†å¸ƒå›¾è¡¨
- âœ… æ˜¾ç¤º Top å…³é”®è¯åˆ—è¡¨
- âœ… æ˜¾ç¤ºç«äº‰å¯¹æ‰‹å¯¹æ¯”
- âœ… æ•°æ®ç¼“å­˜æœºåˆ¶æ­£å¸¸

**Phase 3.3** âœ… å…¨éƒ¨è¾¾æˆ
- âœ… å¯ä»¥æŒ‰å›½å®¶/åœ°åŒº/åŸå¸‚æŸ¥çœ‹æ’å
- âœ… æ”¯æŒä¸åŒåœ°åŒºæ’åå¯¹æ¯”
- âœ… æ˜¾ç¤º GEO ä¼˜åŒ–æœºä¼š

### æŠ€æœ¯äº®ç‚¹

1. **è‡ªåŠ¨åŒ–è¡¨åˆå§‹åŒ–**: é€šè¿‡ `initWebsiteDataTables()` è‡ªåŠ¨åˆ›å»ºæ‰€æœ‰è¡¨
2. **æ™ºèƒ½ç¼“å­˜**: åˆ†çº§ç¼“å­˜ç­–ç•¥ï¼ˆ24h/7å¤©ï¼‰ï¼Œå‡å°‘ API è°ƒç”¨
3. **ç»„ä»¶åŒ–è®¾è®¡**: æ¨¡å—åŒ– UI ç»„ä»¶ï¼Œæ˜“ç»´æŠ¤æ‰©å±•
4. **ç±»å‹å®‰å…¨**: å®Œæ•´ TypeScript ç±»å‹å®šä¹‰
5. **ç”¨æˆ·ä½“éªŒ**: shadcn UI + emerald ä¸»é¢˜ï¼Œæ”¯æŒæ·±è‰²æ¨¡å¼å’Œä¸­è‹±åŒè¯­

### å¾…ä¼˜åŒ–é¡¹

**ä¼˜å…ˆçº§ P0:**
- [ ] é…ç½® SE-Ranking API Key
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

**ä¼˜å…ˆçº§ P1:**
- [ ] å®ç° GEO æ•°æ®è‡ªåŠ¨é‡‡é›†
- [ ] æ·»åŠ æ’åå†å²è¶‹åŠ¿å›¾è¡¨

**ä¼˜å…ˆçº§ P2:**
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆCSV/Excelï¼‰
- [ ] å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ›´æ–°æ’å

---
